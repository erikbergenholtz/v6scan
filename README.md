v6scan
======
`v6scan` is a tool that, hopefully, can perform a scan of an IPv6 network in
less time than 40,000 years.

There are four scanning methods implemented in the tool; eavesdropping,
multicast ICMPv6, multicast IPv6 with hop-by-hop extension headers, and DeHCP.
DeHCP is also implemented for IPv4, and the method can scan the network with
either `ICMP Echo Request` packets, or brief port scans using `nmap`
(`nmap -n -sS -F`). The four methods can be ran individually, or simultaneously.

The methods collect IPv6 address, MAC address, RTT and timestamp for each
observed packet, and stores the information together with the finding method in
a file called `<DIR>/dumpXX.csv`, where `<DIR>` can be specified by the user
(default is `dump`), and `XX` is the number of the file. Whenever more than
10,000 addresses are logged, a new file is created.

Dependencies
------------
`v6scan` is written in C for Linux. It depends on `pcap` and `nmap`.  On Debian
based systems it should be possible to install these dependencies by running

```
# apt install --yes libpcap-dev nmap
```

Note that `v6scan` will compile even if `nmap` is not installed, since `nmap` is
accessed via a `system()` call. Because of this, the dependency won't make
itself known until runtime.

Usage
-----
The tool must be ran as root

```
Usage: ./v6scan [OPTIONS]

OPTIONS:
-h           - Display help text
-p           - Enable multicast ICMP scan
-m           - Enable malformed multicast ICMP scan
-s           - Enable eavesdropping
-x           - Enable DHCP delimiting with ICMP
-z           - Enable DHCP delimiting with `nmap`
-4           - Run DeCHP in IPv4
-6           - Run DeCHP in IPv6
-I <iface>   - Choose interface (chosen by program unless specified)
-a <addr>    - Send packets from <addr> (chosen by kernel unless specified)
-T <addr>    - Use <addr> as seed address for delimiting IPv4 method
-t <addr>    - Use <addr> as seed address for delimiting IPv6 method
-P <length>  - Prefix length of for delimiting IPv6 method, default is 64
-M <mask>    - Netmask of seed address, default it 255.255.255.0
-o <dir>     - Choose output directory (default is `dump`)
-N <num>     - Terminate program after <num> packets of each type are sent
               If left out or set to 0 no limit is imposed.
-w <num>     - Window size used by the DeHCP methods, default is 4
-S           - Dump IPs to STDOUT as they are discovered
-D <sec>     - ICMP delay in seconds (default is 1)
-v           - Increase verbosity (up to three times)
-q           - Quiet mode
-d           - Enable debug messages
```

The scanning methods
--------------------
### Eavesdropping
This method, enabled by the `-s` option, is as simple as it sounds; it simply
enables eavesdropping to the chosen interface. This is done with [`libpcap`][].
The eavesdropping methods does *not* listen for ICMPv6 ECHO REQUEST, ECHO REPLY
or PARAMETER PROBLEM, as these packets are generated by the other methods and
would yield duplicates in the list of discovered addresses.

### Multicast ICMP
The multicast ICMP method sends and ICMPv6 ECHO REQUEST to `ff02::1`, which is
the IPv6 all nodes address. This is similar to the IPv4 broadcast address, and
should under normal conditions reach all nodes on the network. Ideally, all
nodes should answer with an ECHO REPLY. In practice, this is likely not the
case.

If the `-a <addr>` option is *not* enabled, the packets will be sent from
the interface's link-local address, which will yield responses sent from
link-local addresses. By specifying the interface's global address with `-a` the
packets will be sent using that instead, which should elicit responses from the
network node's global addresses.

### Hop-by-Hop
In this method an ICMPv6 ECHO REQUEST is also sent to `ff02::1`, however the
IPv6 hop-by-hop extension header is set to `0x80`. According to
[RFC2460](https://tools.ietf.org/html/rfc2460#section-4.2) this tells the
receiving host to discard the packet and emit an `ICMPv6 PARAMETER PROBLEM`
packet. We hope that this will trigger some of the hosts that do not answer to
normal ICMPv6 ECHO REPLY packets to send a response.

The comment about the `-a <addr>` option above is valid for this method as well.

Author
------
`v6scan` is authored by Erik Bergenholtz (erik.bergenholtz@bth.se).

`dehcpsim`
==========
This is a small program that runs simulations of the DeHCP method over a number
of variables. Currently the following is evaluated:

- Window size (taken as a CLI argument)
- Outer density (od)
- Inner density (id, >od)
- Seed position (relative the DHCP pool)
